<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Management System</title>
  </head>
  <body>
    <h1>Library Management System</h1>
    <script type="text/javascript">
      function Book() {
        let title = "";
        let author = "";
        let genre = "";
        let availability = true;
        Object.defineProperty(this, "title", {
          get: () => title,
          set: (value) => {
            if (!value || value === "" || value == null)
              throw new Error("Title is required.");
            title = value;
          }
        });
        Object.defineProperty(this, "author", {
          get: () => title,
          set: (value) => {
            if (!value || value === "" || value == null)
              throw new Error("Author is required.");
            author = value;
          }
        });
        Object.defineProperty(this, "genre", {
          get: () => title,
          set: (value) => {
            if (!value || value === "" || value == null)
              throw new Error("Genre is required.");
            genre = value;
          }
        });
        Object.defineProperty(this, "availability", {
          get: () => title,
          set: (value) => {
            if (typeof value !== "boolean")
              throw new Error("Availability is required.");
            availability = value;
          },
        });
        this.borrowBook = () => {
          if (!availability)
            throw new Error(`"${title}" book is not available in the library.`);
          availability = false;
          console.log("You have borrowed this book:");
          this.displayInfo();
        };
        this.returnBook = () => {
          if (availability)
            throw new Error(
              `"${title}" book is already available at the library.`
            );
          availability = true;
          console.log("You have returned this book:");
          this.displayInfo();
        };
        this.displayInfo = () => {
          console.log(`Title: ${title}`);
          console.log(`Author: ${author}`);
          console.log(`Genre: ${genre}`);
          console.log(`Availability?: ${availability ? "Yes" : "No"}`);
        };
      }

      function Library() {
        let books = [];
        Object.defineProperty(this, "books", {
          get: () => books,
          set: (value) => {
            if (!Array.isArray(value))
                throw new Error("Books should be array.");
            books = value;
          }
        });
        this.addBook = (title, author, genre) => {
          const book = new Book();
          book.title = title;
          book.author = author;
          book.genre = genre;
          console.log("You have added this book to the library:");
          book.displayInfo();
          books.push(book);
        };
        this.searchBook = (title) => {
          const foundBooks = books.filter((book) =>
            book.title.toLowerCase().includes(title.toLowerCase())
          );
          if (foundBooks.length > 0) {
            console.log(`Found ${foundBooks.length} books(s):`);
            foundBooks.forEach((book) => {
              book.displayInfo();
            });
          } else {
            console.log("No books found with that title.");
          }
        };
        this.displayBooks = () => {
          if (books.length === 0) {
            console.log("No books in the library.");
          } else {
            console.log("These are the books in the library:");
            books.forEach((book) => {
              book.displayInfo();
            });
          }
        };
        this.borrowBook = (title) => {
          const book = books.find(
            (book) => book.title.toLowerCase() === title.toLowerCase()
          );
          if (!book) 
            throw new Error(`"${title}" book is not listed to the library, thus cannot be borrowed.`);
          book.borrowBook();
        };
        this.returnBook = (title) => {
          const book = books.find(
            (book) => book.title.toLowerCase() === title.toLowerCase()
          );
          if (!book) 
            throw new Error(`"${title}" book is not listed to the library, thus cannot be returned.`);
          book.returnBook();
        };
      }
      const library = new Library();
      library.addBook('El Filibusteriso', 'J.P. Rizal','Novel');
      library.addBook('Noli Me Tangere', 'J.P. Rizal','Novel');
      library.addBook('Mi Ultimo Adios', 'J.P. Rizal','Poem');
      library.searchBook('Noli Me Tangere');
      library.displayBooks();
    </script>
  </body>
</html>
